%% Parameters (glucagon, glucose, insulin have different units)
clc, clear
z=[7.9 3.0 1.3 2.0 1.8 5.7 13.0 11.0 6.6 7.0 5.9;
    6.2 20.1 17.3 13.3 6.5 2.8 3.4 5.3 5.7 5.5 5.8;
    0.07 0.39 0.39 0.55 0.17 0.06 0.01 0.01 0.04 0.02 0.08];
f=[-2.478276243 -0.546323784 0.136497543 -0.01713358 0.383421408 0.487991867 -0.133005057 -0.146455579 0.014285402 -0.017880236 0.033054228
    6.95 -0.933333333 -0.8 -0.68 -0.37 0.04 0.126666667 0.013333333 -0.006666667 0.005 0.032222222
    0.161 -0.001333333 0.0336 -0.0382 -0.0113 -0.003133333 6.66667E-05 0.000866667 -0.000633333 0.000933333 0.000422222];
% k0=[.002 .001 .005 .0003 0 .001];

nf=@(x,z)[x(2)*z(3,:)-x(1)*z(2,:)-x(3)*z(2,:)+x(4)*z(1,:)-x(6)*z(2,:)
    x(1)*z(2,:)-x(2)*z(3,:)
    x(3)*z(2,:)-x(4)*z(1,:)-x(5)*z(1,:)];
problem=createOptimProblem('lsqcurvefit','objective',nf,'xdata',z,'ydata',...
    f,'x0',ones(1,6),'lb',zeros(1,6),'ub',[100 100 100 100 100 100])
par=lsqcurvefit(problem);
ms=MultiStart('PlotFcns',@gsplotbestf);
[par,error]=run(ms,problem,50)
  
